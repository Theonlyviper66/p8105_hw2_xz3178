---
title: "HW2"
author: "Xuesen Zhao"
date: "2022-10-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Question 1

```{r}
library(tidyverse)
library(readxl)
```


```{r}
Transit = read_csv("./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv",col_types = cols(Route8 = "c", Route9 = "c", Route10 = "c", Route11 = "c")) %>%
  janitor::clean_names() %>% 
  select(line:entry,exit_only, vending,  
    ada) %>%
  mutate(entry = ifelse(entry=="YES",TRUE,FALSE)) %>%
  mutate(vending = ifelse(vending=="YES",TRUE,FALSE)) 
```

The original dataset contains information about the entrance and exit for each listed subway station in NYC and it had 1868 observations and 32 rows. The column names were formatted and coerced into lower case, and 20 variables were selected from the original dataset, including line, station name, station latitude and longitude, whether a route (1-11) stops at that station, entrance type, entry or exit, vending, and ADA compliance. The resulting dataset now contains 1868 rows and 20 columns. 

Yet, the dataset is not completely clean. There are many rows that contains missing values, route number should be a separate variable. 

```{r}
# distinct station
distinct(Transit, station_name,line,.keep_all = TRUE) 
# ADA compliant
Transit %>% 
  filter(ada == TRUE) %>% 
  select(station_name, line) %>% 
  distinct
# Entry = TRUE, AND vending = FALSE
Transit %>% 
  filter(vending == "NO") %>% 
  pull(entry) %>% 
  mean
```

There are 465 stations that have a distinct combination of station name and line. 84 Stations are ada compliant. There is no station that has entrance/exits without vending but allow entrance. 

```{r}
Transit %>% 
  pivot_longer(
    route1:route11,
    names_to = "route_num",
    values_to = "route") %>% 
  filter(route == "A") %>% 
  select(station_name, line) %>% 
  distinct

Transit %>% 
  pivot_longer(
    route1:route11,
    names_to = "route_num",
    values_to = "route") %>% 
  filter(route == "A", ada == TRUE) %>% 
  select(station_name, line) %>% 
  distinct
```

There are 60 distinct stations that serve the A train, and 17 of them are ADA compliant. 

## Question 2

```{r}
# The columns with notes and the rows with pic were excluded, 
# the resulting dimension of the dataframe is 453X15
Trash_wheel = read_excel("./data/Trash_Wheel.xlsx",sheet = 1, range = "A2:N534") %>%
  janitor::clean_names() %>% 
  drop_na() %>% #rows with notes were dropped
  mutate(Type="Mr",sports_balls=as.numeric(round(sports_balls,0)))

# The columns with notes and the rows with pic were excluded, 
# the resulting dimension of the dataframe is 71X15
Professor_wheel = read_excel("./data/Trash_Wheel.xlsx",sheet = 2, range = "A2:N117") %>%
  janitor::clean_names() %>% 
  drop_na() %>% #rows with notes were dropped
  mutate(Type="Professor",sports_balls=as.numeric(round(sports_balls,0)))

```



```{r}
# The larger df Trash_wheel(x) is left_joined to the Professor trash wheel (y)
# resulting dataframe has 453 rows and 29 columns
combined_wheel = left_join(
  Trash_wheel, Professor_wheel, by="dumpster"
)
combined_wheel %>%
  filter(Type.y=="Professor") %>%
  pull(weight_tons.y)%>%
  sum

combined_wheel %>%
  filter(Type.x=="Mr",year.x==2020)%>%
  pull(sports_balls.x)%>%
  sum
```

The total weight of trash collected by Professor Trash Wheel was 135.5 tons. The total number of sports balls collected by Mr. Trash Wheel in 2020 was 856. 

## Question 3

```{r}
pol_month = read_csv("./data/pols-month.csv") %>%
  janitor::clean_names() %>%
  separate(mon, into = c("year","month","day"),sep = "-") %>%
  mutate(
    year = as.numeric(year),
    month=month.abb[as.numeric(month)],
    president = ifelse(prez_gop==1,"gop","dem"))%>%
  select(-day,-prez_gop,-prez_dem)
  
```


```{r}
snp = read_csv("./data/snp.csv")%>%
  janitor::clean_names() %>%
  separate(date, into = c("month","day","year"),sep = "/") %>% 
  mutate(
    year = as.numeric(year), 
    year=ifelse(year<=20,2000+year,1900+year),
    month=month.abb[as.numeric(month)],
        ) %>%
  select(year,month,close,-day)
```

```{r}
unemploy = read_csv("./data/unemployment.csv") %>%
  janitor::clean_names()%>%
  pivot_longer(
    jan:dec,
    names_to = "month",
    values_to = "unemployment percentage"
  ) %>% 
  mutate(month=str_to_title(month))
```

The pol_month dataset contains information on the number of national politicians who are democratic or republican from 1947 to 2015. The cleaned dataset has 822 rows and 9 observations, including the variables year, month, and president (indicator of if the president is a republican or democratic), and the number of republican or democratic governors (gov), senators (sen), and representative (rep) on the same associated date. 

```{r}
range(pol_month$year)
range(snp$year)
range(unemploy$year)
```


A similar month and year variable was also created in the other two data frames as key variable for merging them together. The snp dataset contains 787 rows and 3 variables, including year (from 1950-2015), month and the closing values of the S&P stock index on the associated date. The unemploy date contains 816 rows and the unemployment percentage of all months from 1948 to 2015. 

```{r}
merge1 = left_join(pol_month,snp,by=c("year","month"))
merged_final = left_join(merge1, unemploy, by=c("year","month"))
```

The final merged dataframe of all three contains 822 rows and 11 columns, including all the variables from the three dataframe.